# 01월 05일

* API 문서 작성
* mysql 서버 생성
* ORM 연동



## API 문서

https://www.notion.so/API-d2bc9783503e4aa2b72ef62a7e9aa14a

Rest API를 나누는 기준을 아직 잘 모르겠다. 지금은 그냥 필요하다! 싶은 것들만 만들고 있다. 명확한 기준이 있었으면 좋겠다. 

하나의 API를 만들면 어떤 에러들을 만들어줘야하는지, 어떤 응답들을 만들어줘야하는지 판단이 잘 되지 않는다. 이것도 필요하다 싶은 것들만 만들어주고 있다. 과연 이 방법이 맞는것인지 많은 고민이 필요하다.

API를 만들때 프론트앤드분들과 많은 이야기가 필요하다는 것을 다시금 깨닫게 되었다. 응답의 종류는 둘째치더라도 성공한 경우 어떤 값을 보내줘야하는지 아직 판단이 잘 서지 않는다. 

## Flask 

### 서버 실행

이전에는 `FLASK_APP=main.py flask run` 명령을 통해 서버를 실행해주었다. FLASK_APP이라는 환경변수에 현재 플라스크 서버의 코드 파일주소를 넣고 플라스크를 실행하는 명령어였다.

Flask_APP 환경변수에 서버 파일 주소를 넣어버리면 실행할 때 코드의 길이가 준다는 사실을 알고 시도해보았다.

```bash
export FLASK_APP=./server/src/main

flask run
```

이렇게 하니 서버가 실행되었다!

하지만 서버의 환경이 배포 환경이었다. 이를 개발 환경으로 바꿔주기로 했다. 

```bash
export FLASK_ENV=development  

Flask run  
```

개발환경으로 서버가 변경되었다. 

개발환경에서는 디버그 모드가 활성되어 서버에서 오류가 발생된 경우 디버그를 진행한다. 또 서버의 코드가 변경되는 경우 자동으로 서버가 재시작된다.

매번 환경변수를 입력하기 귀찮으므로 배치파일을 제작해주었다. 

이제 이 배치파일 하나로 서버의 가상환경과 환경변수까지 설정해준다.

### ORM

데이터베이스의 스키마 설계가 완료되어 이제 ORM을 사용해볼 시간이다. 

```bash
pip3 install Flask-Migrate
pip3 install mysql-connector-python
```

Flask-Migrate를 설치해주었다. `sqlAlchemy ORM`도 함께 설치된다고한다. 

mysql을 사용할 예정이므로 `mysql-connector-python`도 설치해주었다.

그리고 Mysql 초기 세팅을 해주었다. 

사용하는 데이터베이스의 정보를 코드에 유출하면 큰일나므로 관련 정보는 환경변수로 관리해주었다. 

ORM이라길래 데이터베이스 테이블 생성도 가능한 줄 알았다. 하지만 sqlAlchemy는 단지 데이터베이스와 파이썬을 연결해준다는 문구를 stackoverflow에서 발견하였다. 조금 더 리서치를 해봐야겠지만 일단  mysql에서 테이블을 작성하기로 했다. 

.sql파일을 만들었다.

생성은 된다고 나왔다. 하지만 외래키가 잘 연결됬는지 긴가민가하다

```mysql
select * from information_schema.table_constraints where table_name = '테이블이름'
```

위 쿼리문을 통해 제약조건을 확인해주었다. 외래키를 확인하던 도중 테이블을 예전 설계한 대로 만든것을 확인하고 다시 만들어주었다. 

다시 하니 잘 되었고, 모든 제약조건이 원하는대로 설정되어있음을 알게되었다. 

자세한 제약조건은 다음에 공부하면서 설정하기로 했다.

이제 테이블에 값을 추가해주었다. (테스트용)

ORM을 연동하여 데이터베이스 값을 받아올 수 있는지 테스트하는 API를 만들었다. 

당연하게도 에러가 발생했고, 어떤 에러가 발생했는지 웹 화면에 보여주는 것을 보고 감동받았다.

그리고 성공했다! 플라스크를 사용하여 처음 진행하는거라 많은 시간이 걸릴줄 알았는데 생각보다 적은 시간이 걸렸다.

이제 기본적인 작업이 되었으니 이것을 진행하여 다음 태스크를 진행하면 될 것 같다

그전에 파일 분할 하는 방법도 해봐야겠다.